<head>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.4/jquery.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

</head>

<script>
$(document).ready(function () {
  var intervalId; // Variable to store the interval ID

  function respimaticListenFor(uid, callbackFn) {
      $.ajax({
          url: 'https://respimaticlisten.atmanirbhar.org/display_json_response',
          method: 'POST',
          data: {
              uid: uid
          }
      })
      .done(function (response) {
          var timestamp = response.timestamp;
          var jsondata = response.jsonData;

          if (response.data == 'success') {
              console.log(timestamp, jsondata);
              callbackFn(null, timestamp, jsondata);
          } else {
              console.log("UID does not match");
             
          }
      })
      .fail(function (errorThrown) {
          console.error("Error:", errorThrown);
        
      });
  }

  // Define the button click event handler
  function connectButtonClick() {
      var uid = $('#uid').val(); // Get the value of uid from the input field
      respimaticListenFor(uid, function (error, timestamp, jsonData) {
          if (error) {
              // Handle error
              console.error("Callback Error:", error);
          } else {
              // Handle success
              console.log("Callback Success:", timestamp, jsonData);
          }
      });

      // Start the interval after clicking the button
      intervalId = setInterval(function () {
          respimaticListenFor(uid, function (error, timestamp, jsonData) {
              if (error) {
                  // Handle error
                  console.error("Callback Error:", error);
              } else {
                  // Handle success
                  console.log("Callback Success:", timestamp, jsonData);
              }
          });
      }, 100);
  }

  // Add event listener to the button
  $('#connectButton').click(connectButtonClick);
});

</script>

<body>
    <input id='uid' type='text' value='UID_28705904000000EE'></input>
    <button id='connectButton'>CONNECT</button>
</body>

